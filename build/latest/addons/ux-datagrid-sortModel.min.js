/*!
* ux-angularjs-datagrid v.1.6.10
* (c) 2018, Obogo
* https://github.com/obogo/ux-angularjs-datagrid
* License: MIT.
*/
(function (exports, global) {
if (typeof define === "function" && define.amd) {
  define(exports);
} else if (typeof module !== "undefined" && module.exports) {
  module.exports = exports;
} else {
  global.ux = exports;
}


!function(a,b){"function"==typeof define&&define.amd?define(a):"undefined"!=typeof module&&module.exports?module.exports=a:b.ux=a,a.datagrid.events.ON_BEFORE_SORT="datagrid:onBeforeSort",a.datagrid.events.ON_AFTER_SORT="datagrid:onAfterSort",a.datagrid.events.ON_BEFORE_TOGGLE_SORT="datagrid:onBeforeToggleSort",a.datagrid.events.ON_AFTER_TOGGLE_SORT="datagrid:onAfterToggleSort",a.datagrid.events.CLEAR_SORTS="datagrid:clearSorts",a.datagrid.events.CLEAR_ALL_SORTS="datagrid:clearAllSorts";var c="$path";angular.module("ux").service("sortStatesModel",["$location","$rootScope",function(b,d){return a.datagrid.sortStatesModel=function(){function e(a){return"$"===a.charAt(0)}function f(){return b.path()}function g(){return G.getCurrentPath().split("?").shift()}function h(){var a;return a=G.getIgnoreParamsInPath()?G.getCurrentPathWithoutParams():G.getCurrentPath(),a!==I&&(G.log("getPath changed from %s to %s",I,a),I=a),a}function i(a){var b=K[a||G.getPath()];return!0===b||!1===b?b:M}function j(a,b){return b=b||G.getPath(),void 0!==a&&(G.log("setAllowMultipleStates %s",a),K[b]=!0===a),!!K[b]}function k(){return!0===L[G.getCurrentPathWithoutParams()]}function l(a){G.log("setIgnoreParamsInPath %s",a),L[G.getCurrentPathWithoutParams()]=a}function m(a){return a=a||G.getPath(),!!J[a]}function n(a){return a=a||G.getPath(),J[a]||(J[a]={$dirty:!1,$order:[]},J[a][c]=a),J[a]}function o(b){var d,f=b[c],g=G.getPathState(f);G.log("setPathState %s to %s",g,b),G.setIgnoreParamsInPath(!0);for(d in b)d!==c&&a.util.apply(Object.prototype.hasOwnProperty,b,[d])&&b[d]!==g[d]&&!e(d)&&G.setState(d,b[d],g,f)}function p(a,b){var c=G.getPathState(b||G.getPath());return void 0===c[a]&&(c[a]=H.NONE),c[a]}function q(a,b,d,e){var f,g;if(d=d||G.getPathState(e||G.getPath()),!G.isPrivate(a)&&d[a]!==b){if(g=d[a],G.getAllowMultipleStates(d[c])&&-1!==(f=d.$order.indexOf(a))&&d.$order.splice(f,1),b!==H.NONE&&(G.getAllowMultipleStates(e)||G.clear(d),d.$order.push(a)),d[a]=b,!g&&b===H.NONE)return;G.dirtyState(d)}}function r(b,c){b=b||G.getPathState(c||G.getPath());var d={text:"",pathState:b};return a.each(b.$order,G.createKeyFromState,d),d.text}function s(a,b,c,d){G.isPrivate(a)||(d.text+=(d.text.length?"|":"")+a+":"+d.pathState[a])}function t(a,b){var c=G.getState(a,b),d=G.getNextState(c);G.info("toggle %s from %s to %s",a,c,d),G.setState(a,d,null,b),G.dirtyState()}function u(a,b){a=a||G.getPathState(b||G.getPath()),G.log("dirtyState %s",a),a.$dirty=!0}function v(a){a=a||G.getPathState(path||G.getPath()),G.log("clearDirty %s",a),a.$dirty=!1}function w(a){var b=H.ASC;switch(a){case H.NONE:b=H.ASC;break;case H.ASC:b=H.DESC;break;case H.DESC:b=H.NONE}return b}function x(a,b){return a=a||G.getPathState(b||G.getPath()),a.$dirty}function y(a){var b=void 0===a||null===a?"":a;return"string"==typeof b?b.toLowerCase():b}function z(){return"en"}function A(a,b){return a=G.cleanSortValue(a),b=G.cleanSortValue(b),a>b?1:a<b?-1:0}function B(a,b){return 0}function C(a){return function(b,c){var d=b[a],e=c[a];return G.customSorts&&G.customSorts[a]?G.customSorts[a](d,e,"asc",a,b,c):G.sortValueCompare(d,e)}}function D(a){return function(b,c){var d=b[a],e=c[a];return G.customSorts&&G.customSorts[a]?G.customSorts[a](d,e,"desc",a,b,c):-G.sortValueCompare(d,e)}}function E(b,c){var d;b=b||G.getPathState(c||G.getPath()),b.$order.length=0;for(d in b)a.util.apply(Object.prototype.hasOwnProperty,b,[d])&&!G.isPrivate(d)&&b[d]!==H.NONE&&(b[d]=H.NONE)}function F(){J={},K={}}var G=a.logWrapper("columnSortStatesModel",{},"blue",function(){a.util.apply(d.$emit,d,arguments)}),H={ASC:"asc",DESC:"desc",NONE:"none"},I="",J={},K={},L={},M=!1;return G.getPath=h,G.getCurrentPath=f,G.getCurrentPathWithoutParams=g,G.sortValueCompare=A,G.cleanSortValue=y,G.getNextState=w,G.createKeyFromState=s,G.getAllowMultipleStates=i,G.setAllowMultipleStates=j,G.getIgnoreParamsInPath=k,G.setIgnoreParamsInPath=l,G.hasPathState=m,G.getPathState=n,G.setPathState=o,G.getState=p,G.setState=q,G.toggle=t,G.dirtyState=u,G.clearDirty=v,G.sortNone=B,G.createAscSort=C,G.createDescSort=D,G.hasDirtySortState=x,G.createKeyFromStates=r,G.isPrivate=e,G.getLocale=z,G.clear=E,G.clearAll=F,G.sortOptions=H,G}(),a.datagrid.sortStatesModel}]),angular.module("ux").factory("sortModel",["sortStatesModel",function(b){return["inst",function(d){function e(a,b,c){var d=c[b];return d&&k[b]&&ux.util.array.sort(a,k[b][d]),a}function f(a,b,c,d){var f,g;if(!m.groupSort&&d.grouped&&d.ary.length&&d.ary[0].hasOwnProperty(d.grouped))for(g=d.ary.length,f=0;f<g;f+=1)d.ary[f]=angular.extend({},d.ary[f]),d.ary[f][d.grouped]=e(d.ary[f][d.grouped].slice(0),a,d.pathState);else e(d.ary,a,d.pathState)}function g(){var a,e,f=b.hasPathState(m[c]),g=b.getPathState(m[c]);if(m.sorts=m.sorts||d.options.sorts,m.sorts)for(a in m.sorts)"object"==typeof m.sorts[a]?(b.setState(a,m.sorts[a].value,g,m[c]),e=m.sorts[a]):(f||b.setState(a,m.sorts[a],g,m[c]),e={asc:b.createAscSort(a),desc:b.createDescSort(a),none:b.sortNone}),j.addSortColumn(a,e)}var h,i,j=a.logWrapper("sortModel",{},"blue",d),k={},l={},m=d.options.sortModel||{};return j.addSortColumn=function(a,d){k[a]=d;var e=b.getPathState(m[c]);b.customSorts=m.custom,e[a]=e[a]||b.sortOptions.NONE},j.getCache=function(a){return l[a]},j.setCache=function(a,b){l[a]=b},j.applySorts=function(e,g,k){var l=b.getPathState(m[c]),n=angular.copy(l);if(g&&(j.log("apply sortOptions"),b.setPathState(g)),h!==e||b.hasDirtySortState(l,m[c])){if(!(h=e))return i=h;if(k&&j.clear(),j.setCache("",h),!j.$processing){j.$processing=!0;var o,p=b.createKeyFromStates(l),q=angular.copy(l);j.info("applySorts %s",p),o=d.dispatch(a.datagrid.events.ON_BEFORE_SORT,p,n,q),o.defaultPrevented?i=h:(j.getCache(p)&&j.getCache(p).length===h.length?j.log("\tpull sort from cache"):(j.log("\tstore sort %s",p),j.setCache(p,h&&h.slice(0)||[]),ux.each(q.$order,f,{grouped:d.grouped,pathState:q,ary:j.getCache(p)})),i=j.getCache(p),b.clearDirty(l,m[c]),!1===m.enableCache&&j.clear()),j.$processing=!1,d.dispatch(a.datagrid.events.ON_AFTER_SORT,p,q,n)}}return i},j.isApplied=function(a,d){return b.getPathState(m[c])[a]===d},j.getSortStateOf=function(a){return b.getPathState(m[c])[a]},j.multipleSort=b.setAllowMultipleStates,j.getSortKey=b.createKeyFromStates,j.toggleSort=function(e){j.log("toggleSort %s",e),d.dispatch(a.datagrid.events.ON_BEFORE_TOGGLE_SORT,e),d.creepRenderModel&&d.creepRenderModel.stop(),b.toggle(e,m[c]),j.applySorts(h),d.dispatch(a.datagrid.events.ON_AFTER_TOGGLE_SORT,e)},j.setSortStateOf=function(a,d){"none"!==d&&"asc"!==d&&"desc"!==d||b.setState(a,d,null,m[c])},j.clear=function(){l={}},j.destroy=function(){j=null,i=null,k=null,l=null,h=null,d.sortModel=null,d=null},d.unwatchers.push(d.scope.$on(a.datagrid.events.CLEAR_SORTS,a.datagrid.sortStatesModel.clear)),d.unwatchers.push(d.scope.$on(a.datagrid.events.CLEAR_ALL_SORTS,a.datagrid.sortStatesModel.clearAll)),d.sortModel=j,g(),d}]}])}(this.ux=this.ux||{},function(){return this}());
//# sourceMappingURL=ux-datagrid-sortModel.min.js.map
}(this.ux = this.ux || {}, function() {return this;}()));
