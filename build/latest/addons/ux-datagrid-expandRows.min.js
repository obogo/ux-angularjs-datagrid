/*!
* ux-angularjs-datagrid v.1.6.14
* (c) 2018, Obogo
* https://github.com/obogo/ux-angularjs-datagrid
* License: MIT.
*/
(function (exports, global) {
if (typeof define === "function" && define.amd) {
  define(exports);
} else if (typeof module !== "undefined" && module.exports) {
  module.exports = exports;
} else {
  global.ux = exports;
}


!function(a,b){"function"==typeof define&&define.amd?define(a):"undefined"!=typeof module&&module.exports?module.exports=a:b.ux=a,a.datagrid.events.COLLAPSE_ROW="datagrid:collapseRow",a.datagrid.events.EXPAND_ROW="datagrid:expandRow",a.datagrid.events.TOGGLE_ROW="datagrid:toggleRow",a.datagrid.events.ROW_TRANSITION_COMPLETE="datagrid:rowTransitionComplete",a.datagrid.events.COLLAPSE_ALL_EXPANDED_ROWS="datagrid:collapseAllExpandedRows",a.datagrid.options.expandRows=[],a.datagrid.options.expandRows.autoClose=!0,a.datagrid.options.expandRows.scrollOnExpand=!0,a.datagrid.options.expandRows.store=!0,angular.module("ux").factory("expandRows",function(){function b(){var a=document.location.href;return c[a]=c[a]||{},c[a]}var c={};return["inst",function(c){function d(a){return v="number"==typeof a?a:c.getNormalizedIndex(a,v)}function e(a){a.template=a.template||c.templateModel.defaultName,a.cls||a.style||a.swap||c.throwError("expandRows will not work without an cls|style|swap property"),x[a.template]=a}function f(){ux.each(c.options.expandRows,e)}function g(a){var b=d(a);return y[b]&&y[b].name||A.closed}function h(a){return a&&a||"opened"}function i(a,b){b=h(b),g(a)!==b?j(a,b):k(a)}function j(a,b){b=h(b);var e=d(a);if(g(e)!==b){if(w.log("expand %s",a),c.options.expandRows.autoClose&&z)return;z=!0,l([e],!0),z=!0,n(e,b)}}function k(a,b){var c=d(a);g(c)!==A.closed&&(w.log("collapse %s",a),n(c,A.closed,b))}function l(a,b){c.options.expandRows.autoClose&&m(a,!1,b)}function m(b,d,e){a.each(y,function(a,f){var g=parseInt(f,10);(!b||c.rowsLength>g&&-1===b.indexOf(g))&&(d?(k(g,!0),delete y[f]):k(g,e))}),z=!1}function n(a,b,d){var e,f,g,h,i,j,k=c.templateModel.getTemplate(c.data[a],b);if(x[k.name]){if(e=c.getExistingRow(a),h=c.scopes[a],i=e&&e.scope()||!1,!e||!h)return void delete y[a];h.$state=b,f=x[k.name],i&&!1!==f.transition&&e[0].addEventListener(E,r),f.style&&(f.reverse||(f.reverse=p(e,f.style)),e.css(b!==A.closed?f.style:f.reverse)),f.swap&&f.state!==b?(j=b===A.closed?o(f,b):b,g=x[j],g.cls=g.cls||"",c.templateModel.setTemplate(a,j,[g.cls]),e=c.getRowElm(a)):f.cls&&(e[b!==A.closed?"addClass":"removeClass"](f.cls),e.addClass("animating"));var l={target:e[0],index:a,state:b};d?r(l,d):c.flow.add(r,[l],0)}else c.throwError("unable to toggle template. cls for template '"+k.name+"' was not set.")}function o(a,b){return"function"==typeof a.swap?a.swap(c.data[index],b):a.swap}function p(a,b){var c={elm:a,style:b,reverse:{}};return ux.each(b,q,c),c.reverse}function q(a,b,c,d){d.reverse[b]=d.elm.css(b)}function r(b,d){var e,f,g,h;a.util.apply(Object.prototype.hasOwnProperty,b,["index"])?(e=c.getRowElm(b.index),g=b.index,h=b.state):e=angular.element(b.target),f=e.scope(),h&&f?(f.$index=g,f.$state=h):f&&(g=f.$index,h=f.$state),e[0].removeEventListener(E,r),e.removeClass("animating"),h!==A.closed?(y[g]={name:h,index:g,height:parseInt(e[0].offsetHeight||0,10)},isNaN(y[g].height)&&c.throwError("Invalid Height")):delete y[g],c.updateHeights(g),d?z=!1:c.flow.add(function(){c.options.expandRows.scrollOnExpand&&c.scrollModel.scrollIntoView(g,!0),c.dispatch(a.datagrid.events.ROW_TRANSITION_COMPLETE),z=!1,c.options.expandRows.scrollOnExpand&&c.flow.add(function(){h!==A.closed&&g===c.data.length-1&&c.getViewportHeight()<c.getContentHeight()&&c.scrollModel.scrollToBottom(!0)},[],0)},[],0)}function s(a){var b=d(a);return!!y[b]}function t(a){var b=d(a);return y[b]?(w.log("\texpandRow %s to height %s",b,y[b].height),y[b].height):B(a)}function u(){w=null,x=null,y=null,A=null}var v,w=a.logWrapper("expandRows",{},"green",c),x={},y=b(),z=!1,A={opened:"opened",closed:"closed"},B=c.templateModel.getTemplateHeight,C=document.createElement("div").style,D=function(){for(var a="t,webkitT,MozT,msT,OT".split(","),b=0,c=a.length;b<c;b++)if(a[b]+"ransform"in C)return a[b].substr(0,a[b].length-1);return!1}(),E=function(){return!1!==D&&{"":"transitionend",webkit:"webkitTransitionEnd",Moz:"transitionend",O:"oTransitionEnd",ms:"MSTransitionEnd"}[D]}();return C=null,c.templateModel.getTemplateHeight=t,w.states=A,w.getIndex=d,w.toggle=function(a,b){c.flow.add(i,[a,b])},w.expand=function(a,b){c.flow.add(j,[a,b])},w.collapse=function(a){c.flow.add(k,[a])},w.isExpanded=s,w.getState=g,w.destroy=u,c.unwatchers.push(c.scope.$on(a.datagrid.events.ON_READY,f)),c.unwatchers.push(c.scope.$on(a.datagrid.events.EXPAND_ROW,function(a,b){w.expand(b)})),c.unwatchers.push(c.scope.$on(a.datagrid.events.COLLAPSE_ROW,function(a,b){w.collapse(b)})),c.unwatchers.push(c.scope.$on(a.datagrid.events.TOGGLE_ROW,function(a,b,c){w.toggle(b,c)})),c.unwatchers.push(c.scope.$on(a.datagrid.events.ON_ROW_COMPILE,function(a,b,d){if(y[b.$index]){var e=c.templateModel.getTemplate(c.data[b.$index]),f=x[e.name];d[0].classList.add(f.cls)}})),c.unwatchers.push(c.scope.$on(a.datagrid.events.COLLAPSE_ALL_EXPANDED_ROWS,function(a,b){m(null,b)})),a.datagrid.events.ON_BEFORE_TOGGLE_SORT&&c.unwatchers.push(c.scope.$on(a.datagrid.events.ON_BEFORE_TOGGLE_SORT,function(a){m()})),c.expandRows=w,c}]})}(this.ux=this.ux||{},function(){return this}());
//# sourceMappingURL=ux-datagrid-expandRows.min.js.map
}(this.ux = this.ux || {}, function() {return this;}()));
