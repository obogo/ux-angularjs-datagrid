/*!
* ux-angularjs-datagrid v.1.6.14
* (c) 2018, Obogo
* https://github.com/obogo/ux-angularjs-datagrid
* License: MIT.
*/
(function (exports, global) {
if (typeof define === "function" && define.amd) {
  define(exports);
} else if (typeof module !== "undefined" && module.exports) {
  module.exports = exports;
} else {
  global.ux = exports;
}


!function(a,b){"function"==typeof define&&define.amd?define(a):"undefined"!=typeof module&&module.exports?module.exports=a:b.ux=a,a.visibility=function(){function a(d,e,f){var g=d.parentNode;return!!c(d)&&(9===g.nodeType||!(!f&&"0"===b(d,"opacity"))&&("none"!==b(d,"display")&&"hidden"!==b(d,"visibility")&&(!g||g===e||a(g,e,f))))}function b(a,b){return window.getComputedStyle?document.defaultView.getComputedStyle(a,null)[b]:a.currentStyle?a.currentStyle[b]:void 0}function c(a){for(;a=a.parentNode;)if(a==document)return!0;return!1}return{getStyle:b,isVisible:a}}(),a.selector=function(){function b(a,b){b=b||z.config.doc.body;var c,d,e=/:eq\((\d+)\)$/,f=a.match(e);return f&&f.length&&(a=a.replace(e,""),d=f[1]),c=b.querySelectorAll(a),c&&void 0!==d?c[d]:c}function c(c,d){if(e(c)){for(var g,i,k,l=j(d),m=z.config.doc.body,n=h(c,m,l,null,!0);n.count>n.totalCount;)n=n.parent;if(n=n.parent||n,k=n.str||q(n),n.str)for(var o=n.child;o;)k+=" "+o.str,o=o.child;return(n.count>1||n.child&&n.child.count)&&(g=a.util.array.toArray(b(k,m)),i=g.indexOf(c),k+=":eq("+i+")"),k+=f()}return""}function d(a,b,c){if(e(a)){return q(h(a,b,j(c)))+f()}return""}function e(b){return b?(b&&b.length&&void 0===b.nodeType&&a.datagrid.throwError("selector can only build a selection to a single DOMElement. A list was passed."),!0):""}function f(){return z.config.addVisible?":visible":""}function g(a,b){return!("string"!=typeof b||b!==a&&!A.test(a))||!("object"!=typeof b||!a.match(b))}function h(a,b,c,d,e){var f;return a?(b=b||z.config.doc,f={element:a,ignoreClass:c,maxParent:b,classes:k(a,c),attributes:l(a,d),type:a.nodeName&&a.nodeName.toLowerCase()||"",child:d},f.attributes.$unique&&!d||(e?(f.str=q(f,0,null,!0),f.count=b.querySelectorAll(f.str).length,f.count>1&&(f.parent=s(a,b,c,f,e))):f.parent=s(a,b,c,f,e)),f):""}function i(a){return"number"!=typeof a&&"string"==typeof a&&-1===a.indexOf("{")}function j(a){return a=a||[],"function"==typeof a?a:function(b){if(a instanceof Array)for(var c=0,d=a.length;c<d;){if(g(b,a[c]))return!1;c+=1}else if(g(b,a))return!1;return!0}}function k(a,b){var c=ux.filter(a.classList,i);return c=ux.filter(c,y),ux.filter(c,b)}function l(a,b){var c,d=0,e=a.attributes?a.attributes.length:0,f=[],g=n(a.attributes);if(g&&("id"===g.name&&z.config.allowId?f.push("#"+g.value):"id"!==g.name&&f.push(m(g)),f.length))return f.$unique=!0,f;if(z.config.allowAttributes)for(;d<e;)c=a.attributes[d],v[c.name]||w[c.name]||f.push(m(c)),d+=1;return f}function m(a){return"["+o(a.name)+"='"+p(a.value)+"']"}function n(a){for(var b,c,d=0,e=a?a.length:0;d<e;){if(b=a[d],c=o(b.name),w[c])return b;d+=1}return null}function o(a){var b,c,d=1;if(a.indexOf("-")){for(b=a.split("-"),c=b.length;d<c;)b[d]=b[d].charAt(0).toUpperCase()+b[d].substr(1),d+=1;a=b.join("")}return a}function p(a){return a.replace(/"/g,"&quot;").replace(/'/g,"&apos;")}function q(a,b,c,d){var e,f,g;return b=b||0,f=a&&!a.attributes.$unique?q(a.parent,b+1):"",a&&(f+=(f.length?" ":"")+r(a)),b||d||(g=c||a.maxParent,e=g.querySelectorAll&&g.querySelectorAll(f)||[],e.length>1&&(f+=":eq("+t(e,a.element)+")")),f}function r(a){return a.attributes.$unique?a.attributes[0]:a.type+a.attributes.join("")+(a.classes.length?"."+a.classes.join("."):"")}function s(a,b,c,d,e){var f=a.parentNode;return f&&f!==b?h(a.parentNode,b,c,d,e):null}function t(a,b){var c,d=a.length;for(c=0;c<d;c+=1)if(b===a[c])return c;return-1}function u(b){var c,d=[];for(c in b)a.util.apply(Object.prototype.hasOwnProperty,b,[c])&&d.push(b[c]);return d}var v,w,x,y,z,A=/^ng-\w+/;return z={config:{doc:window.document,allowId:!0,allowAttributes:!0,addVisible:!1},addOmitAttrs:function(b){return a.each(arguments,function(a){v[a]=!0}),this},removeOmitAttrs:function(b){return a.each(arguments,function(a){delete v[a]}),this},getOmitAttrs:function(){return u(v)},resetOmitAttrs:function(){v={class:!0,style:!0}},addUniqueAttrs:function(b){return a.each(arguments,function(a){w[a]=!0}),this},removeUniqueAttrs:function(b){return a.each(arguments,function(a){delete w[a]}),this},getUniqueAttrs:function(){return u(w)},resetUniqueAttrs:function(){w={id:!0,uid:!0}},addClassOmitFilters:function(){return a.each(arguments,function(a){x.push(a)}),y=j(x),this},removeClassOmitFilters:function(){return a.each(arguments,function(a){var b=x.indexOf(a);-1!==b&&x.splice(b,1)}),y=j(x),this},getClassOmitFilters:function(){return x.slice(0)},resetClassOmitFilters:function(){x=[],y=j(x)},get:c,getCleanSelector:c,quickSelector:d,reset:function(){z.resetOmitAttrs(),z.resetUniqueAttrs(),z.resetClassOmitFilters()}},z.reset(),z}(),a.datagrid.events.FOCUS_TO_PREV_ELEMENT_OF_SAME="ux-datagrid:focusToPrevElementOfSame",a.datagrid.events.FOCUS_TO_NEXT_ELEMENT_OF_SAME="ux-datagrid:focusToNextElementOfSame",a.datagrid.events.FOCUS_TO_PREV_ELEMENT_OF_SAME_FAILURE="ux-datagrid:focusToPrevElementOfSameFailure",a.datagrid.events.FOCUS_TO_NEXT_ELEMENT_OF_SAME_FAILURE="ux-datagrid:focusToNextElementOfSameFailure",a.datagrid.events.FOCUS_TO_PREV_ELEMENT_OF_SAME_FOUND="ux-datagrid:focusToNextElementOfSameFound",a.datagrid.events.FOCUS_TO_NEXT_ELEMENT_OF_SAME_FOUND="ux-datagrid:focusToNextElementOfSameFound",a.datagrid.events.ON_SCROLL_TO_TOP_ENTER="ux-datagrid:onScrollToTopEnter",a.datagrid.events.ON_SCROLL_TO_BOTTOM_ENTER="ux-datagrid:onScrollToBottomEnter",angular.module("ux").factory("gridFocusManager",function(){return["inst",function(b){function c(a){return void 0===a.length&&(a=angular.element(a)),a}function d(a){K.info("addListeners "+a&&a.name||""),f(n)}function e(a){K.info("removeListeners "+a&&a.name||""),f(o)}function f(a){if(!(isNaN(b.values.activeRange.max)||b.values.activeRange.max<0)){K.info("\tapplyTo: %s - %s",b.values.activeRange.min,b.values.activeRange.max);for(var c,d=b.values.activeRange.min;d<=b.values.activeRange.max;)c=b.getRowElm(d),a(c),d+=1}}function g(a){if(a&&a[0]){return[].slice.call(a[0].querySelectorAll("input,a,select"))}return[]}function h(a){return ux.visibility.isVisible(a,b.getContent()[0],!0)}function i(a,b){for(var c=b.split(":"),d=c.shift(),e=[].slice.call((a[0]||a).querySelectorAll(d));c.length;)e=j(c.shift(),e);return angular.element(e)}function j(a,b){return"eq("===a.substr(0,3)?k(a,b):"visible"===a.substr(0,7)?ux.filter(b,h):b}function k(a,b){var c=a.match(/\d+/)[0];return b[c]?[b[c]]:[]}function l(a){return!(!a||"ng-"!==a.substr(0,3))}function m(a){var c=!a;return!c&&b.options.gridFocusManager&&b.options.gridFocusManager.filterClasses&&(c=-1!==b.options.gridFocusManager.filterClasses.indexOf(a)),c||(c=l(a)),!c}function n(b){var c=g(angular.element(b));c.length&&(c=a.util.matchAll(c,{nodeName:"INPUT"})).length?(K.log("\t\taddListenersToRow"),c=angular.element(c),c.bind("keydown",p)):K.log("\t\tno focusable elements found in row")}function o(b){var c=g(angular.element(b));c.length&&(c=a.util.matchAll(c,{nodeName:"INPUT"})).length?(K.log("\t\tremoveListenersToRow"),c=angular.element(c),c.unbind("keydown",p)):K.log("\t\tno focusable elements found in row")}function p(c){var d,e,f=angular.element(c.currentTarget);K.log("FM: onKeyDown"),c.keyCode===N.ENTER&&c.currentTarget.nodeName.match(/A/)||(c.shiftKey&&c.keyCode===N.ENTER||c.keyCode===N.UP?!q(f)&&(d=b.getRowIndexFromElement(f),e=b.getRowItem(d),b.dispatch(a.datagrid.events.ON_SCROLL_TO_TOP_ENTER,d,e)):c.keyCode!==N.ENTER&&c.keyCode!==N.DOWN||!r(f)&&(d=b.getRowIndexFromElement(f),e=b.getRowItem(d),b.dispatch(a.datagrid.events.ON_SCROLL_TO_BOTTOM_ENTER,d,e)))}function q(a,b){var c=v(a,b);return!s(c,a)&&z(c)}function r(a,b){var c=w(a,b);return!s(c,a)&&z(c)}function s(a,b){return(a[0]||a)===(b[0]||b)}function t(a,c){if(c){for(var d=b.getData(),e=b.getRowIndexFromElement(a)-1;e>=0;e-=1)if(c(d[e]))return!0;if(!b.options.gridFocusManager||!b.options.gridFocusManager.multipleEnterFocusPerRow)return!1}var f=v(a,c);return!(!f||!f.length||f[0]===a)}function u(a,c){if(c){for(var d=b.getData(),e=b.getRowIndexFromElement(a)+1;e<b.rowsLength;e+=1)if(c(d[e]))return!0;if(!b.options.gridFocusManager||!b.options.gridFocusManager.multipleEnterFocusPerRow)return!1}var f=w(a,c);return!(!f||!f.length||f[0]===a)}function v(a,b){return x(a,-1,b)}function w(a,b){return K.log("\tFM: getNextRowFocusElement"),x(a,1,b)}function x(a,d,e){if(K.log("\tfocusToRowElement"),a=c(a),b.element[0].contains(a[0])){var f,g,h,i=b.getRowIndexFromElement(a),j=i+d,k=b.getData(),l=-1;if(g=y(a,i),K.log("\t"+g),b.options.gridFocusManager&&b.options.gridFocusManager.multipleEnterFocusPerRow&&(h=g.match(L),g=g.split(":").shift(),(l=h?parseInt(h[1],10):-1)>=-1&&(j-=d)),j<0||j>=b.rowsLength)return a;for(;e&&k[j]&&!e(k[j]);)j+=d;return K.log("\tselector: %s",g),f=A(j,d,g,e,i,l),f&&f.length?f:a}}function y(a,c){a=a[0]||a;var d,e,f,g,h;return a?(c=c||b.getRowIndexFromElement(a),g=b.getRowElm(c),h=b.options.gridFocusManager,h&&h.enter&&(e=g[0].querySelectorAll(h.enter)||[],-1!==(f=Array.prototype.indexOf.call(e,a)))?(d=e&&e.length||0,b.options.gridFocusManager.enter+(d>1?":eq("+f+")":"")):ux.selector.quickSelector(a,g[0],m)):""}function z(a){K.log("\tperformFocus %o",a[0]);var c=!1;return a[0]&&(b.scrollModel.scrollIntoView(b.getRowIndexFromElement(a),!0),a[0].scrollIntoViewIfNeeded&&a[0].scrollIntoViewIfNeeded({behavior:"smooth"}),a[0].select&&a[0].select(),a[0].focus(),c=!0),c}function A(c,d,e,f,g,h){K.log("\tfindNextRowWithSelection");var j=b.options.gridFocusManager&&b.options.gridFocusManager.multipleEnterFocusPerRow;if(b.options.gridFocusManager&&b.options.gridFocusManager.filterNextPattern)for(;c>0&&c<b.rowsLength-1&&!a.util.isMatch(b.data[c],b.options.gridFocusManager.filterNextPattern);)c+=d;var k,l,m=b.getRowElm(c);if(m[0].classList.contains("uncompiled")?(m[0].classList.remove("uncompiled"),k=i(m[0],e),m[0].classList.add("uncompiled")):k=i(m[0],e),j&&-1!==h&&k.length>1&&(d>0&&h<k.length-1||d<0&&h>0))g===c&&(l=h+d),k=k[l]?angular.element(k[l]):null;else if(j&&g===c){if(c+=d,m=b.getRowElm(c),m[0]===b.getContent()[0])return;m[0].classList.contains("uncompiled")?(m[0].classList.remove("uncompiled"),k=i(m[0],e),m[0].classList.add("uncompiled")):k=i(m[0],e),k.length>1&&(l=B(d,k),k=k[l]?angular.element(k[l]):null)}for(var n=b.getContent(),o=b.getData();!k[0]&&(d>0&&c<b.rowsLength-1||d<0&&c>0);)if(c+=d,!f||f&&f(o[c])){if(m=b.getRowElm(c),m[0]===n[0])return;m.hasClass("uncompiled")&&(b.forceRenderScope(c),m=b.getRowElm(c)),k=j?angular.element(m[0].querySelectorAll(e)):i(m[0],e),j&&k.length>1&&(l=B(d,k),k=k[l]?angular.element(k[l]):angular.element(k[0]))}return k}function B(a,b){return a<0?b.length-1:a>0?0:void 0}function C(a){var c;document.activeElement!==b.element[0]&&b.element[0].contains(document.activeElement)&&(c=b.getRowIndexFromElement(document.activeElement),b.scrollModel.scrollIntoView(c))}function D(a){if(b.options.gridFocusManager&&b.options.gridFocusManager.throttleNextPrev){if(O)return;O=setTimeout(function(){clearTimeout(),O=0},b.options.gridFocusManager.throttleNextPrev)}b.creepRenderModel.stop(),b.flow.add(a,[document.activeElement],0)}function E(c,d){b.element[0].contains(document.activeElement)&&D(function(e){var f=q(e,d);G(),f?b.scope.$emit(a.datagrid.events.FOCUS_TO_PREV_ELEMENT_OF_SAME_FOUND):(K.info("pageUp"),b.scrollModel.pageUp(),b.scope.$emit(a.datagrid.events.FOCUS_TO_PREV_ELEMENT_OF_SAME_FAILURE),I=b.scope.$on(a.datagrid.events.ON_AFTER_RENDER,function(){G(),E(c,d)}))})}function F(c,d){b.element[0].contains(document.activeElement)&&D(function(e){var f=r(e,d);H(),f?b.scope.$emit(a.datagrid.events.FOCUS_TO_NEXT_ELEMENT_OF_SAME_FOUND):(K.info("pageDown"),b.scrollModel.pageDown(),b.scope.$emit(a.datagrid.events.FOCUS_TO_NEXT_ELEMENT_OF_SAME_FAILURE),J=b.scope.$on(a.datagrid.events.ON_AFTER_RENDER,function(){H(),F(c,d)}))})}function G(){if(I){var a=I;I=null,a()}}function H(){if(J){var a=J;J=null,a()}}var I,J,K=a.logWrapper("gridFocusManager",{},"redOrange",b),L=/:eq\((\d+)\)/,M=[],N={ENTER:13,UP:38,DOWN:40},O=0;return ux.selector.config.allowId=!1,ux.selector.config.allowAttributes=!1,ux.selector.config.addVisible=!0,K.resetListeners=function(a){o(a),n(a)},K.hasPrevRowFocusElement=t,K.hasNextRowFocusElement=u,K.focusToPrevRowElement=q,K.focusToNextRowElement=r,K.query=i,K.destroy=function(){for(G(),H();M.length;)M.pop()();M=null,K=null},M.push(b.scope.$on(a.datagrid.events.ON_BEFORE_RESET,e)),M.push(b.scope.$on(a.datagrid.events.ON_BEFORE_RENDER,e)),M.push(b.scope.$on(a.datagrid.events.ON_AFTER_RENDER,d)),M.push(b.scope.$on(a.datagrid.events.FOCUS_TO_PREV_ELEMENT_OF_SAME,E)),M.push(b.scope.$on(a.datagrid.events.FOCUS_TO_NEXT_ELEMENT_OF_SAME,F)),M.push(b.scope.$on(a.datagrid.events.ON_AFTER_HEIGHTS_UPDATED_RENDER,C)),b.gridFocusManager=K,b}]})}(this.ux=this.ux||{},function(){return this}());
//# sourceMappingURL=ux-datagrid-focusManager.min.js.map
}(this.ux = this.ux || {}, function() {return this;}()));
