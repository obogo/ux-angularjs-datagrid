{"version":3,"sources":["ux-datagrid-expandRows.js"],"names":["exports","global","define","amd","module","ux","datagrid","events","COLLAPSE_ROW","EXPAND_ROW","TOGGLE_ROW","ROW_TRANSITION_COMPLETE","COLLAPSE_ALL_EXPANDED_ROWS","options","expandRows","autoClose","scrollOnExpand","store","angular","factory","getStore","path","document","location","href","inst","getIndex","itemOrIndex","lastGetIndex","getNormalizedIndex","setup","item","template","templateModel","defaultName","cls","style","swap","throwError","cache","setupTemplates","each","getState","index","opened","name","states","closed","getType","type","toggle","expand","collapse","result","log","opening","setState","immediate","omitIndexes","closeAll","silent","cacheItemData","intIndex","parseInt","rowsLength","indexOf","state","elm","tpl","swapTpl","s","visible","getTemplate","data","getExistingRow","scopes","scope","$state","transition","addEventListener","TRNEND_EV","onTransitionEnd","reverse","makeReverseStyle","css","runSwap","setTemplate","getRowElm","addClass","evt","target","flow","add","params","reverseStyle","value","key","list","event","util","apply","Object","prototype","hasOwnProperty","element","$index","removeEventListener","removeClass","height","offsetHeight","isNaN","updateHeights","scrollModel","scrollIntoView","dispatch","length","getViewportHeight","getContentHeight","scrollToBottom","isExpanded","getTemplateHeight","superGetTemplateHeight","destroy","logWrapper","dummyStyle","createElement","vendor","vendors","split","i","l","substr","","webkit","Moz","O","ms","unwatchers","push","$on","ON_READY","ON_ROW_COMPILE","$s","el","classList","ON_BEFORE_TOGGLE_SORT","this"],"mappings":"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","file":"ux-datagrid-expandRows.min.js","sourcesContent":["/*!\n* ux-angularjs-datagrid v.1.6.14\n* (c) 2018, Obogo\n* https://github.com/obogo/ux-angularjs-datagrid\n* License: MIT.\n*/\n(function (exports, global) {\nif (typeof define === \"function\" && define.amd) {\n  define(exports);\n} else if (typeof module !== \"undefined\" && module.exports) {\n  module.exports = exports;\n} else {\n  global.ux = exports;\n}\n\nexports.datagrid.events.COLLAPSE_ROW = \"datagrid:collapseRow\";\n\nexports.datagrid.events.EXPAND_ROW = \"datagrid:expandRow\";\n\nexports.datagrid.events.TOGGLE_ROW = \"datagrid:toggleRow\";\n\nexports.datagrid.events.ROW_TRANSITION_COMPLETE = \"datagrid:rowTransitionComplete\";\n\nexports.datagrid.events.COLLAPSE_ALL_EXPANDED_ROWS = \"datagrid:collapseAllExpandedRows\";\n\nexports.datagrid.options.expandRows = [];\n\nexports.datagrid.options.expandRows.autoClose = true;\n\nexports.datagrid.options.expandRows.scrollOnExpand = true;\n\nexports.datagrid.options.expandRows.store = true;\n\nangular.module(\"ux\").factory(\"expandRows\", function() {\n    var store = {};\n    function getStore() {\n        var path = document.location.href;\n        store[path] = store[path] || {};\n        return store[path];\n    }\n    return [ \"inst\", function(inst) {\n        var result = exports.logWrapper(\"expandRows\", {}, \"green\", inst), lastGetIndex, cache = {}, opened = getStore(), opening = false, states = {\n            opened: \"opened\",\n            closed: \"closed\"\n        }, superGetTemplateHeight = inst.templateModel.getTemplateHeight, // transition end lookup.\n        dummyStyle = document.createElement(\"div\").style, vendor = function() {\n            var vendors = \"t,webkitT,MozT,msT,OT\".split(\",\"), t, i = 0, l = vendors.length;\n            for (;i < l; i++) {\n                t = vendors[i] + \"ransform\";\n                if (t in dummyStyle) {\n                    return vendors[i].substr(0, vendors[i].length - 1);\n                }\n            }\n            return false;\n        }(), TRNEND_EV = function() {\n            if (vendor === false) return false;\n            var transitionEnd = {\n                \"\": \"transitionend\",\n                webkit: \"webkitTransitionEnd\",\n                Moz: \"transitionend\",\n                O: \"oTransitionEnd\",\n                ms: \"MSTransitionEnd\"\n            };\n            return transitionEnd[vendor];\n        }();\n        dummyStyle = null;\n        function getIndex(itemOrIndex) {\n            lastGetIndex = typeof itemOrIndex === \"number\" ? itemOrIndex : inst.getNormalizedIndex(itemOrIndex, lastGetIndex);\n            return lastGetIndex;\n        }\n        function setup(item) {\n            item.template = item.template || inst.templateModel.defaultName;\n            if (!item.cls && !item.style && !item.swap) {\n                inst.throwError(\"expandRows will not work without an cls|style|swap property\");\n            }\n            cache[item.template] = item;\n        }\n        function setupTemplates() {\n            ux.each(inst.options.expandRows, setup);\n        }\n        function getState(itemOrIndex) {\n            var index = getIndex(itemOrIndex);\n            return opened[index] && opened[index].name || states.closed;\n        }\n        function getType(type) {\n            return type && type || \"opened\";\n        }\n        function toggle(itemOrIndex, type) {\n            type = getType(type);\n            if (getState(itemOrIndex) !== type) {\n                expand(itemOrIndex, type);\n            } else {\n                collapse(itemOrIndex);\n            }\n        }\n        function expand(itemOrIndex, type) {\n            type = getType(type);\n            var index = getIndex(itemOrIndex);\n            if (getState(index) !== type) {\n                result.log(\"expand %s\", itemOrIndex);\n                // prevent multi-finger expand rows.\n                if (inst.options.expandRows.autoClose && opening) {\n                    return;\n                }\n                opening = true;\n                autoClose([ index ], true);\n                opening = true;\n                setState(index, type);\n            }\n        }\n        function collapse(itemOrIndex, immediate) {\n            var index = getIndex(itemOrIndex);\n            if (getState(index) !== states.closed) {\n                result.log(\"collapse %s\", itemOrIndex);\n                setState(index, states.closed, immediate);\n            }\n        }\n        function autoClose(omitIndexes, immediate) {\n            if (inst.options.expandRows.autoClose) {\n                closeAll(omitIndexes, false, immediate);\n            }\n        }\n        function closeAll(omitIndexes, silent, immediate) {\n            exports.each(opened, function(cacheItemData, index) {\n                var intIndex = parseInt(index, 10);\n                if (!omitIndexes || inst.rowsLength > intIndex && omitIndexes.indexOf(intIndex) === -1) {\n                    if (silent) {\n                        collapse(intIndex, true);\n                        delete opened[index];\n                    } else {\n                        collapse(intIndex, immediate);\n                    }\n                }\n            });\n            opening = false;\n        }\n        function setState(index, state, immediate) {\n            var template = inst.templateModel.getTemplate(inst.data[index], state), elm, tpl, swapTpl, s, visible, swap;\n            if (cache[template.name]) {\n                elm = inst.getExistingRow(index);\n                s = inst.scopes[index];\n                visible = elm && elm.scope() || false;\n                if (!elm || !s) {\n                    // we must be closing a row out of view. possibly destroyed.\n                    delete opened[index];\n                    return;\n                }\n                s.$state = state;\n                tpl = cache[template.name];\n                if (visible && tpl.transition !== false) {\n                    elm[0].addEventListener(TRNEND_EV, onTransitionEnd);\n                }\n                if (tpl.style) {\n                    if (!tpl.reverse) {\n                        tpl.reverse = makeReverseStyle(elm, tpl.style);\n                    }\n                    elm.css(state !== states.closed ? tpl.style : tpl.reverse);\n                }\n                if (tpl.swap && tpl.state !== state) {\n                    swap = state === states.closed ? runSwap(tpl, state) : state;\n                    swapTpl = cache[swap];\n                    swapTpl.cls = swapTpl.cls || \"\";\n                    inst.templateModel.setTemplate(index, swap, [ swapTpl.cls ]);\n                    elm = inst.getRowElm(index);\n                } else if (tpl.cls) {\n                    elm[state !== states.closed ? \"addClass\" : \"removeClass\"](tpl.cls);\n                    elm.addClass(\"animating\");\n                }\n                // we need to wait for the heights to update before updating positions.\n                var evt = {\n                    target: elm[0],\n                    index: index,\n                    state: state\n                };\n                if (immediate) {\n                    onTransitionEnd(evt, immediate);\n                } else {\n                    inst.flow.add(onTransitionEnd, [ evt ], 0);\n                }\n            } else {\n                inst.throwError(\"unable to toggle template. cls for template '\" + template.name + \"' was not set.\");\n            }\n        }\n        function runSwap(tpl, state) {\n            return typeof tpl.swap === \"function\" ? tpl.swap(inst.data[index], state) : tpl.swap;\n        }\n        function makeReverseStyle(elm, style) {\n            var params = {\n                elm: elm,\n                style: style,\n                reverse: {}\n            };\n            ux.each(style, reverseStyle, params);\n            return params.reverse;\n        }\n        function reverseStyle(value, key, list, params) {\n            params.reverse[key] = params.elm.css(key);\n        }\n        function onTransitionEnd(event, immediate) {\n            var elm, s, index, state;\n            if (exports.util.apply(Object.prototype.hasOwnProperty, event, [ \"index\" ])) {\n                elm = inst.getRowElm(event.index);\n                index = event.index;\n                state = event.state;\n            } else {\n                elm = angular.element(event.target);\n            }\n            s = elm.scope();\n            if (state && s) {\n                s.$index = index;\n                s.$state = state;\n            } else if (s) {\n                index = s.$index;\n                state = s.$state;\n            }\n            elm[0].removeEventListener(TRNEND_EV, onTransitionEnd);\n            elm.removeClass(\"animating\");\n            if (state !== states.closed) {\n                opened[index] = {\n                    name: state,\n                    index: index,\n                    height: parseInt(elm[0].offsetHeight || 0, 10)\n                };\n                if (isNaN(opened[index].height)) {\n                    inst.throwError(\"Invalid Height\");\n                }\n            } else {\n                delete opened[index];\n            }\n            inst.updateHeights(index);\n            // if opening and collapsing a row at the same time, we don't want to do this twice.\n            if (immediate) {\n                opening = false;\n            } else {\n                // we told the heights to update. Give time for them to change then fire the event.\n                inst.flow.add(function() {\n                    if (inst.options.expandRows.scrollOnExpand) {\n                        inst.scrollModel.scrollIntoView(index, true);\n                    }\n                    inst.dispatch(exports.datagrid.events.ROW_TRANSITION_COMPLETE);\n                    opening = false;\n                    if (inst.options.expandRows.scrollOnExpand) {\n                        inst.flow.add(function() {\n                            // check for last row. On expansion it needs to scroll down.\n                            if (state !== states.closed && index === inst.data.length - 1 && inst.getViewportHeight() < inst.getContentHeight()) {\n                                inst.scrollModel.scrollToBottom(true);\n                            }\n                        }, [], 0);\n                    }\n                }, [], 0);\n            }\n        }\n        function isExpanded(itemOrIndex) {\n            var index = getIndex(itemOrIndex);\n            return !!opened[index];\n        }\n        function getTemplateHeight(item) {\n            var index = getIndex(item);\n            if (opened[index]) {\n                result.log(\"\\texpandRow %s to height %s\", index, opened[index].height);\n                return opened[index].height;\n            }\n            return superGetTemplateHeight(item);\n        }\n        function destroy() {\n            result = null;\n            cache = null;\n            opened = null;\n            states = null;\n        }\n        // override the getTemplateHeight to return the result with the expanded height.\n        inst.templateModel.getTemplateHeight = getTemplateHeight;\n        result.states = states;\n        result.getIndex = getIndex;\n        result.toggle = function(itemOrIndex, type) {\n            inst.flow.add(toggle, [ itemOrIndex, type ]);\n        };\n        result.expand = function(itemOrIndex, type) {\n            inst.flow.add(expand, [ itemOrIndex, type ]);\n        };\n        result.collapse = function(itemOrIndex) {\n            inst.flow.add(collapse, [ itemOrIndex ]);\n        };\n        result.isExpanded = isExpanded;\n        result.getState = getState;\n        result.destroy = destroy;\n        inst.unwatchers.push(inst.scope.$on(exports.datagrid.events.ON_READY, setupTemplates));\n        inst.unwatchers.push(inst.scope.$on(exports.datagrid.events.EXPAND_ROW, function(event, itemOrIndex) {\n            result.expand(itemOrIndex);\n        }));\n        inst.unwatchers.push(inst.scope.$on(exports.datagrid.events.COLLAPSE_ROW, function(event, itemOrIndex) {\n            result.collapse(itemOrIndex);\n        }));\n        inst.unwatchers.push(inst.scope.$on(exports.datagrid.events.TOGGLE_ROW, function(event, itemOrIndex, type) {\n            result.toggle(itemOrIndex, type);\n        }));\n        inst.unwatchers.push(inst.scope.$on(exports.datagrid.events.ON_ROW_COMPILE, function(event, $s, el) {\n            if (opened[$s.$index]) {\n                var template = inst.templateModel.getTemplate(inst.data[$s.$index]), tpl = cache[template.name];\n                el[0].classList.add(tpl.cls);\n            }\n        }));\n        inst.unwatchers.push(inst.scope.$on(exports.datagrid.events.COLLAPSE_ALL_EXPANDED_ROWS, function(event, silent) {\n            closeAll(null, silent);\n        }));\n        if (exports.datagrid.events.ON_BEFORE_TOGGLE_SORT) {\n            inst.unwatchers.push(inst.scope.$on(exports.datagrid.events.ON_BEFORE_TOGGLE_SORT, function(event) {\n                closeAll();\n            }));\n        }\n        // inst.unwatchers.push(inst.scope.$on(exports.datagrid.events.ON_BEFORE_DATA_CHANGE, function (event) {\n        //     closeAll(null, true);\n        // }));\n        inst.expandRows = result;\n        return inst;\n    } ];\n});\n}(this.ux = this.ux || {}, function() {return this;}()));\n"]}