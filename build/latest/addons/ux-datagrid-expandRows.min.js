/*!
* ux-angularjs-datagrid v.1.6.9
* (c) 2018, Obogo
* https://github.com/obogo/ux-angularjs-datagrid
* License: MIT.
*/
(function (exports, global) {
if (typeof define === "function" && define.amd) {
  define(exports);
} else if (typeof module !== "undefined" && module.exports) {
  module.exports = exports;
} else {
  global.ux = exports;
}


!function(a,b){"function"==typeof define&&define.amd?define(a):"undefined"!=typeof module&&module.exports?module.exports=a:b.ux=a,a.datagrid.events.COLLAPSE_ROW="datagrid:collapseRow",a.datagrid.events.EXPAND_ROW="datagrid:expandRow",a.datagrid.events.TOGGLE_ROW="datagrid:toggleRow",a.datagrid.events.ROW_TRANSITION_COMPLETE="datagrid:rowTransitionComplete",a.datagrid.events.COLLAPSE_ALL_EXPANDED_ROWS="datagrid:collapseAllExpandedRows",a.datagrid.options.expandRows=[],a.datagrid.options.expandRows.autoClose=!0,a.datagrid.options.expandRows.scrollOnExpand=!0,angular.module("ux").factory("expandRows",function(){return["inst",function(b){function c(a){return t="number"==typeof a?a:b.getNormalizedIndex(a,t)}function d(a){a.template=a.template||b.templateModel.defaultName,a.cls||a.style||a.swap||b.throwError("expandRows will not work without an cls|style|swap property"),v[a.template]=a}function e(){ux.each(b.options.expandRows,d)}function f(a){var b=c(a);return w[b]&&w[b].name||y.closed}function g(a){return a&&a||"opened"}function h(a,b){b=g(b),f(a)!==b?i(a,b):j(a)}function i(a,d){d=g(d);var e=c(a);if(f(e)!==d){if(u.log("expand %s",a),b.options.expandRows.autoClose&&x)return;x=!0,k([e],!0),m(e,d)}}function j(a,b){var d=c(a);f(d)!==y.closed&&(u.log("collapse %s",a),m(d,y.closed,b))}function k(a,c){b.options.expandRows.autoClose&&l(a,!1,c)}function l(c,d,e){a.each(w,function(a,f){var g=parseInt(f,10);(!c||b.rowsLength>g&&c.indexOf(g)===-1)&&(d?(j(g,!0),delete w[f]):j(g,e))}),x=!1}function m(a,c,d){var e,f,g,h,i,j,k=b.templateModel.getTemplate(b.data[a],c);if(v[k.name]){if(e=b.getExistingRow(a),h=b.scopes[a],i=e&&e.scope()||!1,!e||!h)return void delete w[a];h.$state=c,f=v[k.name],i&&f.transition!==!1&&e[0].addEventListener(C,p),f.style&&(f.reverse||(f.reverse=n(e,f.style)),e.css(c!==y.closed?f.style:f.reverse)),f.swap&&f.state!==c?(j="function"==typeof f.swap?f.swap(b.data[a],c):f.swap,g=v[j],g.cls=g.cls||"",b.templateModel.setTemplate(a,j,[g.cls]),e=b.getRowElm(a)):f.cls&&(e[c!==y.closed?"addClass":"removeClass"](f.cls),e.addClass("animating"));var l={target:e[0],index:a,state:c};d?p(l,d):b.flow.add(p,[l],0)}else b.throwError("unable to toggle template. cls for template '"+k.name+"' was not set.")}function n(a,b){var c={elm:a,style:b,reverse:{}};return ux.each(b,o,c),c.reverse}function o(a,b,c,d){d.reverse[b]=d.elm.css(b)}function p(c,d){var e,f,g,h;a.util.apply(Object.prototype.hasOwnProperty,c,["index"])?(e=b.getRowElm(c.index),g=c.index,h=c.state):e=angular.element(c.target),f=e.scope(),h&&f?(f.$index=g,f.$state=h):f&&(g=f.$index,h=f.$state),e[0].removeEventListener(C,p),e.removeClass("animating"),h!==y.closed?(w[g]={name:h,index:g,height:parseInt(e[0].offsetHeight||0,10)},isNaN(w[g].height)&&b.throwError("Invalid Height")):delete w[g],b.updateHeights(g),d?x=!1:b.flow.add(function(){b.options.expandRows.scrollOnExpand&&b.scrollModel.scrollIntoView(g,!0),b.dispatch(a.datagrid.events.ROW_TRANSITION_COMPLETE),x=!1,b.options.expandRows.scrollOnExpand&&b.flow.add(function(){h!==y.closed&&g===b.data.length-1&&b.getViewportHeight()<b.getContentHeight()&&b.scrollModel.scrollToBottom(!0)},[],0)},[],0)}function q(a){var b=c(a);return!!w[b]}function r(a){var b=c(a);return w[b]?(u.log("\texpandRow %s to height %s",b,w[b].height),w[b].height):z(a)}function s(){u=null,v=null,w=null,y=null}var t,u=a.logWrapper("expandRows",{},"green",b),v={},w={},x=!1,y={opened:"opened",closed:"closed"},z=b.templateModel.getTemplateHeight,A=document.createElement("div").style,B=function(){for(var a,b="t,webkitT,MozT,msT,OT".split(","),c=0,d=b.length;c<d;c++)if(a=b[c]+"ransform",a in A)return b[c].substr(0,b[c].length-1);return!1}(),C=function(){if(B===!1)return!1;var a={"":"transitionend",webkit:"webkitTransitionEnd",Moz:"transitionend",O:"oTransitionEnd",ms:"MSTransitionEnd"};return a[B]}();return A=null,b.templateModel.getTemplateHeight=r,u.states=y,u.getIndex=c,u.toggle=function(a,c){b.flow.add(h,[a,c])},u.expand=function(a,c){b.flow.add(i,[a,c])},u.collapse=function(a){b.flow.add(j,[a])},u.isExpanded=q,u.getState=f,u.destroy=s,b.unwatchers.push(b.scope.$on(a.datagrid.events.ON_READY,e)),b.unwatchers.push(b.scope.$on(a.datagrid.events.EXPAND_ROW,function(a,b){u.expand(b)})),b.unwatchers.push(b.scope.$on(a.datagrid.events.COLLAPSE_ROW,function(a,b){u.collapse(b)})),b.unwatchers.push(b.scope.$on(a.datagrid.events.TOGGLE_ROW,function(a,b,c){u.toggle(b,c)})),b.unwatchers.push(b.scope.$on(a.datagrid.events.ON_ROW_COMPILE,function(a,c,d){if(w[c.$index]){var e=b.templateModel.getTemplate(b.data[c.$index]),f=v[e.name];d[0].classList.add(f.cls)}})),b.unwatchers.push(b.scope.$on(a.datagrid.events.COLLAPSE_ALL_EXPANDED_ROWS,function(a,b){l(null,b)})),a.datagrid.events.ON_BEFORE_TOGGLE_SORT&&b.unwatchers.push(b.scope.$on(a.datagrid.events.ON_BEFORE_TOGGLE_SORT,function(a){l()})),b.unwatchers.push(b.scope.$on(a.datagrid.events.ON_BEFORE_DATA_CHANGE,function(a){l(null,!0)})),b.expandRows=u,b}]})}(this.ux=this.ux||{},function(){return this}());
//# sourceMappingURL=ux-datagrid-expandRows.min.js.map
}(this.ux = this.ux || {}, function() {return this;}()));
